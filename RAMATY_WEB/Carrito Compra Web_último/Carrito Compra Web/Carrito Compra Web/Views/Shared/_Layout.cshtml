<!DOCTYPE html>

<html>
    <head>
        <title>@ViewBag.Title</title>
    
        <link href="@Url.Content("~/Content/themes/redmond/jquery-ui-1.8.20.custom.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/arquitectura.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/menu.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/destacados.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/jquery-fixed.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/ui.jqgrid.css")" rel="stylesheet" type="text/css" />
        <link href="@Url.Content("~/Content/themes/redmond/jquery.ui.all.css")" rel="stylesheet" type="text/css" />

        <script src="@Url.Content("~/Scripts/jquery-1.7.2.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.core.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.widget.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.button.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.effects.core.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.effects.highlight.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/grid.locale-es.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.jqGrid.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/messages.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.dialog.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.mouse.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.draggable.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.position.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.resizable.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.datepicker.min.js")" type="text/javascript"></script>
        <script src="@Url.Content("~/Scripts/jquery.ui.datepicker-es.js")" type="text/javascript"></script>

        <script src="@Url.Content("~/Scripts/validator.js")" type="text/javascript"></script>
    </head>
    <body>
		<div id="wrapper" align="center">
			<div id="menu">
                <a href="@Url.Content("~/Home/Index")">Inicio</a>
				<a href="@Url.Content("~/AboutUs")">Sobre nosotros</a>
                <a href="@Url.Content("~/Productos/ListarProducto")">Productos</a>
				<a href="@Url.Content("~/News")">Novedades</a>
				<a href="@Url.Content("~/Contact")">Contacto</a>
			</div>

			<div id="header">
				<div id="logo">
					<font color="#FF0000">RAMATY</font> S.A.
				</div>
				<div id="lema">Nuestra prioridad es la total satisfacción de nuestros Clientes</div>

				<div id="destacados">
					<div id="verde" align="left">
						<div id="titulo_verde">Pedidos web</div>
						<div id="cuerpo_verde">Incorporamos un nuevo servicio:Nuestros Clientes podrán realizar Pedidos a través de la página Web.</div>
					</div>

					<div  id="celeste">
						<div id="titulo_celeste">Producción</div>
						<div id="cuerpo_celeste">Incorporamos nuevos procesos de Producción y de Calidad.</div>
					</div>

					<div id="naranja">
						<div id="titulo_naranja">Capacitación</div>
						<div id="cuerpo_naranja">Incorporamos Capacitacion sobre Seguridad Laboral para nuestros Empleados</div>
					</div>
				</div>
			</div>

			<div id="main">
				<div id="left_column" align="left">
				    <div id="content">
                        @RenderBody()
                    </div>
                </div>

				<div id="right_column" align="left">   <!-- en la 2da linea siguiente abría q preguntar por el verdadero -->
					@{
                        if (Carrito_Compra_Web.SessionController.Session.Login != null && Carrito_Compra_Web.SessionController.Session.Login.IsLogged)
                        {
                            <form action="@Url.Content("~/Home/Logout")" method="post">
                                <div class="right-menu-title"><font color="#FF0000">Su sesión</font></div>
                                <div id="div_login" class="right-menu-text">
						            <p>
                                        Bienvenido/a señor/a <a href="@Url.Content("~/Register/EditRegistro")"> @Carrito_Compra_Web.SessionController.Session.Login.Usuario.NombreDeUsuario </a>:
                                    </p>
                                    <p>
                                        <b>Razón social:</b> @Carrito_Compra_Web.SessionController.Session.Login.Cliente.Apellido, @Carrito_Compra_Web.SessionController.Session.Login.Cliente.Nombre
                                        <br />
                                        <b>CUIT:</b> @Carrito_Compra_Web.SessionController.Session.Login.Cliente.NumeroDocumento
                                    </p>

                                    <p style="text-align:center;">
                                        <a href="javascript:void(0)" onclick="modalCarrito()"><img src="@Url.Content("~/Images/ConsultarCarrito.png")" alt="Consultar Pedidos"/></a>
                                        <a href="@Url.Content("~/Pedidos/NuevoPedido")"><img src="@Url.Content("~/Images/pedidos.png")" alt="Consultar Pedidos"/></a>
                                    </p>
                                   

                                    <div style="width:100%; text-align:center; margin-top:5px;">
                                        <button id="btn_logout" class="text-button">Finalizar sesión</button>
                                    </div>
					            </div>
                            </form>
                        }
                        else
                        {
                            <form method="post" action="@Url.Content("~/Home/Login")">
                                <div class="right-menu-title"><font color="#FF0000">Inicio de sesión</font></div>
                                <div id="div_login" class="right-menu-text">
                                    <label for="txt_user_name" id="lbl_user_name" class="ui-label">Usuario:</label>
                                    <input name="txt_user_name" type="text" id="txt_user_name" class="ui-input-text text ui-widget-content ui-corner-all" style="width:100%;" value="@ViewBag.NombreUsuario" maxlength="50"/>

                                    <label for="txt_password" id="lbl_password" class="ui-label">Contraseña:</label>
                                    <input name="txt_password" type="password" id="txt_password" class="ui-input-password text ui-widget-content ui-corner-all" style="width:100%;" maxlength="50"/>

                                    @{
                                        if (Carrito_Compra_Web.SessionController.Session.Login != null)
                                        { 
                                            <br />
                                            <p class="ui-state-error">@Carrito_Compra_Web.SessionController.Session.Login.ErrorMessage</p>
                                        }
                                        Carrito_Compra_Web.SessionController.Session.Login = null;
                                    }

                                    <div style="width:100%; text-align:center; margin-top:5px;">
                                        <button id="btn_login" class="text-button">Ingresar</button>
                                    </div>
                                    @{
                                        string url = this.Url.RouteUrl(this.ViewContext.RouteData.Values);
                                        /* Solo muestro el registrar si el tipo no se está registrando. */
                                        if (url != "/Register/NuevoRegistro" && url != "/Register/Registrar")
                                        {
                                            <p>
                                                Si aún no está registrado, puede hacerlo <a href="@Url.Content("~/Register/NuevoRegistro")">aquí</a>                                    
                                            </p>
                                        }
                                    }
					            </div>
                            </form>
                        }
                    }

                    <div class="right-menu-title">Compromiso</div>
					<div class="right-menu-text">
						Nos esforzamos cada día en hacer mejor nuestra tarea .
					</div>
					<div class="right-menu-text">
						Brindamos un valor agregado que nos diferencie de nuestros competidores.
					</div>
					<div class="right-menu-text">
						Establecemos un compromiso de calidad con nuestros clientes.
					</div>
					<div class="right-menu-text">
						Estamos atentos a cada una de sus necesidades para optimizar su negocio, que también es el nuestro.
					</div>

					<br/>
					
					<div class="right-menu-title"><font color="#FF0000">Producción</font></div>
					<div class="right-menu-text">
						Contamos con altos procesos de calidad de producción.
					</div>
					<div class="right-menu-text">
						Logramos satisfacer los tiempos de entregas que nuestros clientes necesitan.
					</div>
					<div class="right-menu-text">
						Contamos con equipamiento de primera calidad para lograr productos de excelencia en el mercado.
					</div>
					<div class="right-menu-text">
						Contamos con capacitaciones constantes de nuestro equipo de producción para lograr una mejora contínua en nuestra empresa.
					</div>
				</div>

                <div style="clear:both;"></div>
			</div>

			<div id="footer">
				<div id="flinks"> 
					<a href="@Url.Content("~/Home/Index")">Inicio</a>
					&nbsp;|&nbsp;
					<a href="@Url.Content("~/AboutUs")">Sobre nosotros</a>
					&nbsp;|&nbsp;
					<a href="@Url.Content("~/Productos/ListarProducto")">Productos</a>
					&nbsp;|&nbsp;
					<a href="@Url.Content("~/News")">Novedades</a>
					&nbsp;|&nbsp;
					<a href="@Url.Content("~/Contact")">Contactos</a>
				</div>
				<br />	
				<div id="powered_by">RAMATY <b> UNA EMPRESA CON COMPROMISO</b></div>
			</div>
		</div>
        <div id="modal_carrito_compra">
            
        </div>

        <div id="dialog-message">
            
        </div>

	</body>

    <script type="text/javascript">
        var codigo_producto = 0;

        $(window).ready(function (handler) {
            $("#btn_login").button();
            $("#btn_logout").button();
        });

        function modalCarrito() {
            var str = "";
            $.ajax({
                type: "POST",
                url: '@Url.Content("~/Productos/MostrarCarrito")',
                contentType: "application/json",
                crossDomain: true,
                success: function (data) {
                    if (!data.HayError && data != null) {
                        str += "<div id='fecha_requerida'>";
                        str += "Fecha Requerida:  ";
                        str += "<input name='txt_fecha_requerida' disabled='disabled' type='text' id='txt_fecha_requerida' class='ui-date-time text ui-widget-content ui-corner-all' value='" + data.FechaRequerida + "'/>";  //habría que hacer que muestre la fecha actual
                        str += "</div>";
                        str += "<br />";
                        str += "<br />";

                        str += "<table id='tbl_resumen_pedido' class='ui-widget'>";
                        str += "<thead class='ui-widget-header'>";
                        str += "<tr>";
                        str += "<th style='text-align:left;'>Producto</th>";
                        str += "<th style='width:0; text-align:center;'>Precio&nbspunitario</th>";
                        str += "<th style='width:0; text-align:center;'>Cantidad</th>";
                        str += "<th style='width:0; text-align:right;'>Total</th>";
                        str += "<th style='width:0;'></th>";
                        str += "</tr>"; //Cierra el table-row de la cabecera
                        str += "</thead>"; //Cierra la cabecera

                        str += "<tbody class='ui-widget-content'>";
                        var impar = 0;
                        var class_style = "odd-row"; //odd = impar; even = par.
                        for (i in data.DetallesPedido) {

                            if (impar == 0) {
                                class_style = "even-row";
                                impar = 1;
                            }
                            else {
                                class_style = "odd-row";
                                impar = 0;
                            }
                            str += "<tr class='" + class_style + "'>";
                            str += "<td style='text-align:left;padding-left:8px;'>" + data.DetallesPedido[i].Producto.Nombre + "</td>";
                            str += "<td style='text-align:center;'>$" + data.DetallesPedido[i].Precio + "</td>";
                            str += "<td style='text-align:center;'>" + data.DetallesPedido[i].Cantidad + "</td>";
                            str += "<td style='text-align:right;'>$" + data.DetallesPedido[i].Total + "</td>";
                            str += '<td style="text-align:center;"><a href="javascript:void(0)" onClick="delete_ToKart(' + data.DetallesPedido[i].Producto.Codigo + ')"><img src="@Url.Content("~/Images/Copia de Symbol Delete.png")" alt="Quitar del Carrito" title="Quitar del Carrito"/></a></td>';
                            str += "</tr>";
                        }
                        str += "</tbody>"; //Cierra el cuerpo
                        str += "</table>"; //Cierra la tabla

                        str += "<br />";
                        str += "<br />";

                        str += "<div id='carrito_compra_pie'>";
                        str += "Total: $<span id='total_value'>" + data.Total + "</div>";
                        str += "</div>"; //cierra el pie del carrito.

                        showDialogCarrito("Carrito de compra", str, true, functionAccept, functionCancel);

                        $("#txt_fecha_requerida").datepicker({
                            minDate: 0,
                            showOn: "button",
                            buttonImage: '@Url.Content("~/Images/calendar.png")',
                            buttonImageOnly: true,
                            onSelect: function (dateText, inst) {
                                update_date(dateText);
                            }
                        });
                    }
                    else {
                        $("#modal_carrito_compra").dialog("close");
                        showMessage("Carrito de compra", data.DescripcionError);
                    }
                }
            });
        }

        function update_date(dateText) { 
            var objData = 
            {
                fecha_requerida: dateText
            };

            $.ajax({
                type: "POST",
                url: '@Url.Content("~/Productos/ActualizarFechaRequerida")',
                contentType: "application/json",
                crossDomain: true,
                data: JSON.stringify(objData),
                success: function (data) {
                    if (data.HayError) {
                        showError("Error", data.DescripcionError);
                        $("#txt_fecha_requerida").val(data.Fecha);
                    }
                },
                error: function (error, obj, obj2) {
                    showError("Error", error);
                }
            });
        }

        /* Función que confirma el carrito de compra */
        function functionAccept() {
            var fechaReq = $("#txt_fecha_requerida").val();
            var objData = 
            {
                fechaReq: fechaReq
            };

            $.ajax({
                type: "POST",
                url: '@Url.Content("~/Productos/GrabarPedido")',
                data: JSON.stringify(objData),
                contentType: "application/json",
                crossDomain: true,
                success: function (data) {
                    if (!data.HayError) {
                        showMessage("Mensaje del sistema", "Su pedido ha sido confirmado, puede ir a la sección \'Consultar Pedidos\' para cancelar.");

                        $("#modal_carrito_compra").html("");
                        $("#modal_carrito_compra").dialog("close");
                    }
                    else {
                        showError("Carrito de compra", data.DescripcionError);
                    }
                }
            });
        }

        /* Muestra un cartel de confirmación antes de limpiar el carrito */
        function functionCancel() {
            showAceptAndCancel("Carrito de compra", "Usted perdera todo el carrito de compra. ¿Esta seguro de continuar?", limpiarCarrito, volverAtras);
        }

        /* Función que cancela el carrito de compra.
        Elimina todo */
        function limpiarCarrito() {
            $.ajax({
                type: "POST",
                url: '@Url.Content("~/Productos/limpiarCarro")',
                contentType: "application/json",
                crossDomain: true,
                success: function (data) 
                {
                    if (!data.HayError) 
                    {
                        modalCarrito();
                    }
                    else 
                    {
                        showError("Carrito de compra", data.DescripcionError);
                    }
                }
            });
        }

        /* Funcion salir del carrito de compra, ni confirma ni cancela */
        function volverAtras() {

        }

        /* Muestra un cartel de confirmación si desea o no eliminar un item del carrito de compra */
        function delete_ToKart(codigo) {
            codigo_producto = codigo;
            showAceptAndCancel("Carrito de compra", "¿Esta seguro de querer quitar el producto?", confirmDelete, volverAtras);
        }

        /* Función que elimina efectivamente el item del carrito de compra */
        function confirmDelete(){
            var objData = {
                codigo: codigo_producto
            };

            codigo_producto = 0;
            $.ajax({
                type: "POST",
                url: '@Url.Content("~/Productos/quitarProducto")',
                contentType: "application/json",
                crossDomain: true,
                data: JSON.stringify(objData),
                success: function (data) {
                    if (!data.HayError) {
                        modalCarrito();
                    }
                    else {
                        showError("Carrito de compra", data.DescripcionError);
                    }
                }
            });
        }

    </script>
</html>
